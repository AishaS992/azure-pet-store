name: Deploy ETL Infrastructure

parameters:
- name: resourceGroupName
  displayName: Resource Group
  type: string
  default: ETLTest
- name: location
  displayName: Location
  type: string
  default: eastus
  values:
  - eastus
  - eastus2
  - westus
  - westus2

trigger: none

variables:
  vmImageName: 'ubuntu-latest'
  azureServiceConnection: 'Azure'
  templateFile: 'azure-cloud/petstore/iac/bicep/etl/main.bicep'
pool:
  vmImage: $(vmImageName)

steps:
- task: AzureCLI@2
  inputs:
    azureSubscription: $(azureServiceConnection)
    scriptType: bash
    scriptLocation: inlineScript
    inlineScript: |
      az --version
      az group create --name ${{ parameters.resourceGroupName }} --location ${{ parameters.location }}
      az deployment group create --resource-group ${{ parameters.resourceGroupName }} --template-file $(templateFile)